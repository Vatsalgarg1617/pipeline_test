pipeline{
     agent any
    
    
   stages{
      stage('Compile Stage'){

     steps{
      withMaven(maven : 'Maven'){
         bat 'cd internal_folder & mvn clean install'
        }
     }
   }
  
    stage('Testing Stage'){

     steps{
      withMaven(maven : 'Maven'){
         bat 'cd internal_folder & mvn test'


        }
     }
   }


   stage ('SonarQube Analysis'){
     steps{
     withSonarQubeEnv('sonarqube') {
    bat 'cd internal_folder & mvn org.sonarsource.scanner.maven:sonar-maven-plugin:3.2:sonar'

         }
    }
}

                              stage ('Artifactory Deploy'){
                                             steps{
                                                            script {
                                                            def server = Artifactory.server('JFrog')
                                                            def rtMaven = Artifactory.newMavenBuild()
                                                            rtMaven.resolver server: server, releaseRepo: 'libs-release', snapshotRepo: 'libs-snapshot'
                                                            rtMaven.deployer server: server, releaseRepo: 'vatsal', snapshotRepo: 'vatsal'
                                                            rtMaven.tool = 'Maven'
                                                            def buildInfo = rtMaven.run pom: 'internal_folder/pom.xml', goals: 'install'
                                                            server.publishBuildInfo buildInfo
                                                                                          }
                                                                           }
                                                            }


     stage('Deployment Stage'){

     steps{
      withMaven(maven : 'Maven'){

         bat 'cd internal_folder & mvn install'

        }
     }
   }

           
   }
}
